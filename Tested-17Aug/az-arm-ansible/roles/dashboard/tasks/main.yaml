---
- name: Create parameters
  template:
    src: templates/azuredeploy.parameters.j2
    dest: "azuredeploy.parameters.json"

#Option 2 - Using azcollection way
- name: Create Azure Deploy
  azure.azcollection.azure_rm_deployment:
    resource_group: "{{ rgname }}"
    name: "{{ deployname }}"
    parameters:
      dashboardname:
        value: "{{ dashboardname }}"
      environment:
        value: "{{ env }}"
      subscriptionId:
        value: "{{ subscriptionId }}"
      location:
        value: " {{ location }}"
    template_link: "https://raw.githubusercontent.com/tiwariashwanth/AST-Ansible-Dashboard/feature/at/parameterize/Tested-17Aug/az-arm-ansible/armfiles/azuredeploy-template.json"
  register: azure

# Option 1 - Deploying Azure Dashboard using ARM template and parameter file. Parameter file is generated using Jinja2 and parameters supplied during ansible playbook run

# - name: Deploy ARM template
#   shell: az deployment group create \
#     --name {{deployname}} \
#     --resource-group {{ rgname }} \
#     --template-uri "https://raw.githubusercontent.com/tiwariashwanth/AST-Ansible-Dashboard/feature/at/parameterize/Tested-17Aug/az-arm-ansible/armfiles/azuredeploy-template.json" \
#     --parameters @azuredeploy.parameters.json
#   register: deploy


# - name: Output
#   debug:
#     msg: "{{ deploy.stdout }}"